<!doctype html>
<html windowtype='navigator:browser' hidechrome="false" accelerated="false">
  <head>
    <meta charset='utf-8'>

    <script>
      navigator.serviceWorker.register('sw.js').then(function(registration) {
        dump('ServiceWorker registration success for: ' + registration.scope + '\n');
      }).catch(function(error) {
        dump('ServiceWorker registration failed: ' + error + '\n');
      });

      const MAIN_DOC_PATH = "src/index.html";

      window.addEventListener("DOMContentLoaded", function listener(e) {
        window.removeEventListener("DOMContentLoaded", listener);
        let iframe = document.getElementById("content-primary");
        iframe.src = MAIN_DOC_PATH + window.location.search;
      });

      // Forward mochitest event to the main document.
      window.addEventListener("mochitest-load", function(e) {
        let [ flavor, url ] = e.detail;
        let iframe = document.getElementById("content-primary");
        iframe.contentWindow.postMessage({ location: url }, "*");
      }, true);

    </script>

    <style>
      html, body, iframe {
        width: 100%;
        height: 100%;
        font-size: 10px;

        border: 0;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      html, body {
        min-width: 800px;
        min-height: 600px;
      }

      iframe {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
      }

    </style>
  </head>

  <body>
    <iframe id="extensions" hidden mozbrowser src="src/extensions/"></iframe>
    <iframe id="content-primary" mozframetype="content-primary" mozbrowser transparent src="src/index.html"></iframe>
  </body>
</html>

